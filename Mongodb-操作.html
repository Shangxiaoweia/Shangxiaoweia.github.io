<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>商伟的技术博客</title>
	<meta name="description" content="">
	<meta name="author" content="商伟">

	<!-- HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
		<script src="/theme/html5.js"></script>
	<![endif]-->

	<!-- Styles -->
	<link href="/theme/bootstrap.min.css" rel="stylesheet">
	<link href="/theme/local.css" rel="stylesheet">
	<link href="/theme/pygments.css" rel="stylesheet">

	<!-- Feeds -->




</head>
<body>
	<div class="topbar">
	  <div class="topbar-inner">
		<div class="container-fluid">
		  <a class="brand" href="/">商伟的技术博客</a>
			<ul class="nav">
					<li ><a href="/category/django.html">Django</a></li>
					<li ><a href="/category/git.html">GIT</a></li>
					<li ><a href="/category/javascript.html">JavaScript</a></li>
					<li class="active"><a href="/category/mongodb.html">Mongodb</a></li>
					<li ><a href="/category/mysql.html">MySQL</a></li>
					<li ><a href="/category/pa-chong.html">爬虫</a></li>
					<li ><a href="/category/python.html">Python</a></li>
					<li ><a href="/category/rabbitmq.html">RabbitMQ</a></li>
					<li ><a href="/category/redis.html">redis</a></li>
					<li ><a href="/category/sui-shou-bi-ji.html">随手笔记</a></li>
					<li ><a href="/category/supervisor.html">Supervisor</a></li>
					<li ><a href="/category/vue.html">VUE</a></li>
					<li ><a href="/category/wang-luo.html">网络</a></li>
					<li ><a href="/category/xiao-cheng-xu.html">小程序</a></li>
					<li ><a href="/category/xu-ni-huan-jing.html">虚拟环境</a></li>
			</ul>
			<p class="pull-right"><a href="/archives.html">[archives]</a> <a href="/tags.html">[tags]</a></p>
		</div>
	  </div>
	</div>

	<div class="container-fluid">
	  <div class="sidebar">
		<div class="well">
			<h3>Blogroll</h3>
			<ul>
				<li><a href="http://getpelican.com/">Pelican</a></li>
				<li><a href="http://python.org/">Python.org</a></li>
				<li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
				<li><a href="https://shangxiaoweia.github.io/puzzle.html">拼图</a></li>
			</ul>
			<div class="social">
			<h3>Social</h3>
			<ul>
				<li><a href="https://han520min.github.io">hanmin</a></li>
			</ul>
			</div>
		</div>
	  </div>
	  <div class="content">
	<div class='article'>
		<div class="page-header"><h1>Mongodb-操作</h1></div>
		<div class="well small">Permalink: <a class="more" href="/Mongodb-操作.html">1000-01-01 18:44:00+00:09</a>
by <a class="url fn" href="/author/shang-wei.html">商伟 </a>
 in <a href="/category/mongodb.html">Mongodb</a>
tags: <a href="/tag/mongodb.html">Mongodb</a> </div>
		<div><h5>命令</h5>
<div class="highlight"><pre><span></span>$ mongo    # 进入到mongo命令行
&gt; use test    # 连接到test数据库
</pre></div>


<p>启动服务后，进入 MongoDB 命令行操作界面：</p>
<div class="highlight"><pre><span></span>mongo
</pre></div>


<p>使用 use 命令创建数据库：</p>
<div class="highlight"><pre><span></span>use mydb
</pre></div>


<p>查看当前连接的数据库：</p>
<div class="highlight"><pre><span></span>db
</pre></div>


<p>查看所有的数据库：</p>
<div class="highlight"><pre><span></span>show dbs
</pre></div>


<h5>删除数据库</h5>
<p>使用 db.dropDatabase() 销毁数据库：</p>
<div class="highlight"><pre><span></span>&gt; use <span class="nb">local</span>
switched to db <span class="nb">local</span>
&gt; db.dropDatabase<span class="o">()</span>
</pre></div>


<p>查看所有的数据库：</p>
<div class="highlight"><pre><span></span>&gt; show dbs
</pre></div>


<h5>创建集合</h5>
<p>在数据库 mydb 中创建一个集合</p>
<div class="highlight"><pre><span></span>&gt; use mydb
switched to db mydb
&gt; db.createCollection<span class="o">(</span><span class="s2">&quot;users&quot;</span><span class="o">)</span>
</pre></div>


<p>查看创建的集合：</p>
<div class="highlight"><pre><span></span>&gt; show collections
</pre></div>


<h5>删除集合</h5>
<p>删除集合的方法如下：（删除 users 集合）</p>
<div class="highlight"><pre><span></span>&gt; show collections
&gt; db.users.drop<span class="o">()</span>
</pre></div>


<p>查看是否删除成功：</p>
<div class="highlight"><pre><span></span>&gt; show collections
</pre></div>


<h5>insert()</h5>
<p>插入数据时，如果 users 集合没有创建会自动创建。</p>
<div class="highlight"><pre><span></span>&gt; use mydb
switched to db mydb
&gt; db.users.insert<span class="o">([</span>
... <span class="o">{</span> name : <span class="s2">&quot;jam&quot;</span>,
... email : <span class="s2">&quot;jam@qq.com&quot;</span>
... <span class="o">}</span>,
... <span class="o">{</span> name : <span class="s2">&quot;tom&quot;</span>,
... email : <span class="s2">&quot;tom@qq.com&quot;</span>
... <span class="o">}</span>
... <span class="o">])</span>
</pre></div>


<h5>save()</h5>
<p>插入数据时，如果 users 集合没有创建会自动创建。</p>
<div class="highlight"><pre><span></span>&gt; use mydb2
switched to db mydb2
&gt; db.users.save<span class="o">([</span>
... <span class="o">{</span> name : <span class="s2">&quot;jam&quot;</span>,
... email : <span class="s2">&quot;jam@qq.com&quot;</span>
... <span class="o">}</span>,
... <span class="o">{</span> name : <span class="s2">&quot;tom&quot;</span>,
... email : <span class="s2">&quot;tom@qq.com&quot;</span>
... <span class="o">}</span>
... <span class="o">])</span>
</pre></div>


<h5>find() 语句</h5>
<div class="highlight"><pre><span></span>&gt; db.post.find<span class="o">()</span>    <span class="c1">#这条语句会返回 post 集合中的所有文档</span>
</pre></div>


<h5>pretty() 语句</h5>
<p>pretty() 可以使查询输出的结果更美观。</p>
<div class="highlight"><pre><span></span>&gt; db.post.find<span class="o">()</span>.pretty<span class="o">()</span>
</pre></div>


<h5>OR</h5>
<p>MongoDB 中，OR 查询语句以 <code>$or</code> 作为关键词，用法如下：</p>
<div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">db</span><span class="p">.</span><span class="n">post</span><span class="p">.</span><span class="n">find</span><span class="p">(</span>
  <span class="err">{</span>
    <span class="err">$</span><span class="k">or</span><span class="p">:</span> <span class="p">[</span>
      <span class="err">{</span><span class="n">key1</span><span class="p">:</span> <span class="n">value1</span><span class="err">}</span><span class="p">,</span> <span class="err">{</span><span class="n">key2</span><span class="p">:</span><span class="n">value2</span><span class="err">}</span>
    <span class="p">]</span>
  <span class="err">}</span>
<span class="p">).</span><span class="n">pretty</span><span class="p">()</span>
</pre></div>


<h5>操作范例：</h5>
<div class="highlight"><pre><span></span>&gt; db.post.find<span class="o">({</span>
    <span class="s2">&quot;likes&quot;</span>: <span class="o">{</span><span class="nv">$gt</span>:10<span class="o">}</span>,
    <span class="nv">$or</span>: <span class="o">[</span>
        <span class="o">{</span><span class="s2">&quot;by&quot;</span>: <span class="s2">&quot;shiyanlou&quot;</span><span class="o">}</span>,
        <span class="o">{</span><span class="s2">&quot;title&quot;</span>: <span class="s2">&quot;MongoDB Overview&quot;</span><span class="o">}</span>
    <span class="o">]</span>
<span class="o">})</span>.pretty<span class="o">()</span>
</pre></div>


<p><code>{$gt:10}</code> 表示大于 10，另外，<code>$lt</code> 表示小于、<code>$gte</code> 表示大于等于、<code>$lte</code> 表示小于等于、<code>$ne</code> 表示不等于。</p>
<h5>db.createCollection(name,options)</h5>
<p>参数描述：</p>
<ul>
<li>name：创建的集合名称</li>
<li>options：是一个作为初始化的文档(可选)</li>
</ul>
<p>范例：</p>
<div class="highlight"><pre><span></span>&gt; db.createCollection<span class="o">(</span><span class="s2">&quot;shiyanlou&quot;</span><span class="o">)</span> <span class="c1">#无参数</span>
<span class="o">{</span> <span class="s2">&quot;ok&quot;</span> : <span class="m">1</span> <span class="o">}</span>
&gt; show collections
shiyanlou
system.indexes
&gt; db.createCollection<span class="o">(</span><span class="s2">&quot;shiyanlou2&quot;</span>, <span class="o">{</span> capped : <span class="m">1</span>, autoIndexId : <span class="m">1</span>, size : <span class="m">6142800</span>, max : <span class="m">10000</span> <span class="o">}</span> <span class="o">)</span> <span class="c1">#带参数</span>
<span class="o">{</span> <span class="s2">&quot;ok &quot;</span>: <span class="m">1</span> <span class="o">}</span>
</pre></div>


<p>参数描述：</p>
<ul>
<li><code>capped</code>：类型为 Boolean，如果为 true 则创建一个固定大小的集合，当其条目达到最大时可以自动覆盖以前的条目。在设置其为 true 时也要指定参数大小；</li>
<li><code>autoIndexId</code>：类型为 Boolean，默认为 false，如果设置为 true，则会在 _id 字段上自动创建索引；</li>
<li><code>size</code>：如果 capped 为 true 则需要指定，指定参数的最大值，单位为 byte；</li>
<li><code>max</code>：指定最大的文档数</li>
</ul>
<h5>db.COLLECTION.drop()</h5>
<h5>删除操作实例：</h5>
<div class="highlight"><pre><span></span>&gt; use Chenshi
switched to db Chenshi
&gt; show collections
shiyanlou
shiyanlou2
system.indexes
&gt; db.shiyanlou.drop<span class="o">()</span>
<span class="nb">true</span>
</pre></div>


<p><strong>语法：db.COLLECTION.drop()</strong></p>
<p>操作实例：</p>
<div class="highlight"><pre><span></span>&gt; use Chenshi
switched to db Chenshi
&gt; show collections
shiyanlou
shiyanlou2
system.indexes
&gt; db.shiyanlou.drop<span class="o">()</span>
<span class="nb">true</span>
</pre></div>


<h5>插入文档</h5>
<h5>语法：db.COLLECTION_NAME.insert(document)</h5>
<div class="highlight"><pre><span></span>use Chenshi
switched to db Chenshi
db.shiyanlou.insert<span class="o">(</span>userdoc1<span class="o">)</span>
</pre></div>


<p><strong>语法：db.COLLECTION_NAME.update(SELECTION_CRITERIA,UPDATED_DATA)</strong></p>
<p>操作实例：</p>
<div class="highlight"><pre><span></span>&gt; db.shiyanlou.update<span class="o">({</span><span class="s2">&quot;user_id&quot;</span>:2,<span class="s2">&quot;e-mail&quot;</span>:<span class="s2">&quot;test@qq.com&quot;</span><span class="o">}</span>,<span class="o">{</span><span class="nv">$set</span>:<span class="o">{</span><span class="s2">&quot;e-mail&quot;</span>:<span class="s2">&quot;group@qq.com&quot;</span><span class="o">}})</span>
WriteResult<span class="o">({</span><span class="s2">&quot;nMatched&quot;</span>:1,<span class="s2">&quot;nUpserted&quot;</span>:1,<span class="s2">&quot;nModified&quot;</span>:1<span class="o">})</span>
&gt; db.shiyanlou.find<span class="o">()</span>
</pre></div>


<ul>
<li>将 user_id=2 的文档的 e-mail 改为 <a href="mailto:group@qq.com">group@qq.com</a></li>
<li>第一个大括号内容标示查找条件，第二个大括号内容则表示更新后的数据</li>
<li>默认的 update 函数只对一个文档更新，如果想作用所有文档，则需要加入 multi:true</li>
</ul>
<p>操作实例：</p>
<div class="highlight"><pre><span></span>db.shiyanlou.update<span class="o">({</span><span class="s2">&quot;e-mail&quot;</span>:<span class="s2">&quot;test@qq.com&quot;</span><span class="o">}</span>,<span class="o">{</span><span class="nv">$set</span>:<span class="o">{</span><span class="s2">&quot;e-mail&quot;</span>:<span class="s2">&quot;group@qq.com&quot;</span><span class="o">}}</span>,<span class="o">{</span>multi:true<span class="o">})</span>
</pre></div>


<p><strong>语法：db.COLLECTION_NAME.save({_id:ObjectId(),NEW_DATA})</strong></p>
<p>操作实例：</p>
<div class="highlight"><pre><span></span>&gt; db.shiyanlou.save<span class="o">({</span><span class="s2">&quot;_id&quot;</span>:ObjectId<span class="o">(</span><span class="s2">&quot;53ea174ccb4c62646d9544f4&quot;</span><span class="o">)</span>,<span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;Bob&quot;</span>,<span class="s2">&quot;position&quot;</span>:<span class="s2">&quot;techer&quot;</span><span class="o">})</span>
WriteResult<span class="o">({</span><span class="s2">&quot;nMatched&quot;</span>:1,<span class="s2">&quot;nUpserted&quot;</span>:1,<span class="s2">&quot;nModified&quot;</span>:1<span class="o">})</span>
</pre></div>


<p>这里的 _id 对应的是要替换文档的 _id。</p>
<p>跟 insert 差不多，但是 save 更好用。</p>
<h5>删除文档</h5>
<p><strong>语法：db.COLLECTION_NAME.remove(DELECTION_CRITERIA)</strong></p>
<p>操作实例：</p>
<div class="highlight"><pre><span></span>&gt; db.shiyanlou.remove<span class="o">({</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;Bob&quot;</span><span class="o">})</span>
WriteResult<span class="o">({</span><span class="s2">&quot;nRemoved&quot;</span>:1<span class="o">})</span>
</pre></div>


<p>其实 remove 函数的参数跟 update 函数的第一个参数一样，相当于查找条件，注意，不要误删！</p>
<p>删除后可以用查找命令确认数据：</p>
<div class="highlight"><pre><span></span>&gt; db.shiyanlou.find<span class="o">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">本节实验介绍了集合和文档的基本操作，其中：</span>

<span class="n">createCollection</span><span class="p">()</span><span class="err">：创建集合</span>
<span class="n">db</span><span class="p">.</span><span class="n">COLLECTION</span><span class="p">.</span><span class="k">drop</span><span class="p">()</span><span class="err">：删除集合</span>
<span class="n">db</span><span class="p">.</span><span class="n">COLLECTION_NAME</span><span class="p">.</span><span class="k">insert</span><span class="p">(</span><span class="n">document</span><span class="p">)</span><span class="err">：插入文档</span>
<span class="n">db</span><span class="p">.</span><span class="n">COLLECTION_NAME</span><span class="p">.</span><span class="k">update</span><span class="p">(</span><span class="n">SELECTION_CRITERIA</span><span class="p">,</span><span class="n">UPDATED_DATA</span><span class="p">)</span><span class="err">：更新文档</span>
<span class="n">db</span><span class="p">.</span><span class="n">COLLECTION_NAME</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="err">{</span><span class="n">_id</span><span class="p">:</span><span class="n">ObjectId</span><span class="p">(),</span><span class="n">NEW_DATA</span><span class="err">}</span><span class="p">)</span><span class="err">：替换已存在的文档</span>
<span class="n">db</span><span class="p">.</span><span class="n">COLLECTION_NAME</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">DELECTION_CRITERIA</span><span class="p">)</span><span class="err">：删除文档</span>
</pre></div></div>
	</div>
		<footer>
		  <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme based on <a href="http://twitter.github.com/bootstrap/">Twitter Bootstrap</a>.</p>
		  <p>&copy; 商伟</p>
		</footer>
	  </div>

	</div>
</body>
</html>