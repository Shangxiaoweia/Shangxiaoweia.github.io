<!DOCTYPE html>
<html lang="en">
<head>
        <title>支付宝沙箱模式</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="/theme/css/main.css" type="text/css" />
        <link href="/" type="application/atom+xml" rel="alternate" title="商伟的技术博客 ATOM Feed" />


        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="/css/ie.css"/>
                <script src="/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="/css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="">商伟的技术博客 </a></h1>
                <nav><ul>
                    <li ><a href="/category/my-shang.html">my-shang</a></li>
                </ul></nav>
        </header><!-- /#banner -->
        
<section id="content" class="body">    
<article>
        <header> <h1 class="entry-title"><a href="my-支付宝沙箱.html"
        rel="bookmark" title="Permalink to 支付宝沙箱模式">支付宝沙箱模式</a></h1>   </header>
        <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2019-08-08T18:44:00+02:00">
                周四 08 八月 2019
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/shang-wei.html">商伟</a>
        </address>
<p>In <a href="/category/my-shang.html">my-shang</a>. </p>
<p>tags: <a href="/tag/shang.html">shang</a></p></p>
</footer><!-- /.post-info -->        <h3>支付宝支付</h3>
<ul>
<li>安装模块</li>
</ul>
<p><code>shell
  pip install Crypto 
  pip install pycryptodome
  pip install python-alipay-sdk</code></p>
<ul>
<li>
<p>下载RSA工具
  <img alt="img" src="https://img2018.cnblogs.com/blog/1354307/201911/1354307-20191107134351045-2102495901.png"></p>
</li>
<li>
<p>将生成的公钥上传到支付宝沙箱的RSA2(SHA256)密钥(推荐）处</p>
</li>
</ul>
<p><img alt="img" src="https://img2018.cnblogs.com/blog/1354307/201911/1354307-20191107134403625-1800493074.jpg"></p>
<ul>
<li>设置公钥后会生成一个支付宝公钥，将其复制</li>
</ul>
<p><img alt="img" src="https://img2018.cnblogs.com/blog/1354307/201911/1354307-20191107134416436-1047655704.png"></p>
<ul>
<li>然后将其写入一个文件 <code>alipay_pulic_key.pem</code></li>
</ul>
<p><code>shell
  -----BEGIN PUBLIC KEY-----
  MIGfMA0GCSqGSIb3DQEBAQUAA4GNIgHnOn7LLILlKETd6BFRJ0GqgS2Y3mn1wMQmyh9zEyWlz5p1zrahRahbXAfCfSqshSNfqOmAQzSHRVjCqjsAw1jyqrXaPdKBmr90DIpIxmIyKXv4GGAkPyJ/6FTFY99uhpiq0qadD/uSzQsefWo0aTvP/65zi3eof7TcZ32oWpwIDAQAB
  -----END PUBLIC KEY-----</code></p>
<ul>
<li>把之前生成的私钥也写入另外一个文件 <code>app_private_key.pem</code></li>
</ul>
<p><code>shell
  -----BEGIN RSA PRIVATE KEY-----
  MIIEowIBAAKCAQEAgxk5N/XQkRatTn56TxGo8nVGk4YKb7VheSDtcLezj7sDdibVamrWz/77VG1GY17Q2jOnCoHpngWDsJybZ/5icblvk3I76H5GT+zjYMBbHXfAlnRB7BG6+Vo7YWe442S0E+A8z8N+R3MArSb3+Coht+8JgvGNdsVE9u2upmxq4GHMKDu/TY3Q7lPIXW3iL6Kxn/4L2u+EdTstlwDi141unF2r7evpBO21XNBFPdjzoSjHgV00UqpLxmoO5v9IHb2XOgOL/V0Jgl/OQ3VBTADg9yL5NcC4CvpX4QEFJlnXBMusdlvCd7VvqIK7PO1Befxjnam5Gbdl4+ONqSaXzBUuXQIDAQABAoIBAG7zZPqYXqi8QXZiEk9iydJRMKbf1WtPXawvEuTHg/9LrhVLrmj+KpiaJKJ6Fxl8CgYAF/bfeVqe2lxSGGNe9Sp9ipTBiidLxvU8QM/zlVbKr30Y35kEJ3eclw9XO+jbrOaP7Y8XmhcYIH0ts/2RCBHKFI4NODCBW/8YNysFVQT15M7goM18dIpgQVWGGzK3L+1Gg0PZ1YP2So8rKXvktLuSyk2ZACtkDCVI0dK9VxKe6pwKBgApw9URT8CXGS2ObLntoX8nQ73ItP3EYoAUdy3uAGHNNX/8mSNFDt0zt3ZidqM5+JxUNOke1GrFdx1MNt4sk6yk596fbMDjiLULp1lLr8KCmvlUZKay2Rfes4OcK9NnF4S3jwS4HDIQXQrnAyqnjvOc08wBhkXsfnU+KEpVglFx1AoGBAJBqcnm+hwM1OOZ4HubD/3Ct4/BWvHDwDe8fCVqkspTXyVs94rjzPUTekwg3Q7p6GrC/ZdekmrqL6K/OpZcXqqlQTkvSe+3Wic4aqEa73+2qemAE+3rDZ2nf1cQrIPSBIPLSTHdkuoxLiSL4f8XZQeSUsTTTFRoaoaNtbo/ayuQw
  -----END RSA PRIVATE KEY-----</code></p>
<ul>
<li>
<p>这样沙箱配置结束了。</p>
</li>
<li>
<p>python与支付宝交互</p>
</li>
</ul>
<p>```shell
  import random
  from alipay import AliPay</p>
<p>def Index():
      ali = AliPay(
          appid='2016101000655050',
          app_notify_url=None,
          alipay_public_key_path=r'E:\robot_study\alipay_pulic_key.pem',
          app_private_key_path=r'E:\robot_study\app_private_key.pem',
          debug=True
      )</p>
<div class="highlight"><pre><span></span>  <span class="nv">data</span> <span class="o">=</span> {
      <span class="s1">&#39;</span><span class="s">subject</span><span class="s1">&#39;</span>: <span class="s1">&#39;</span><span class="s">一生的价格</span><span class="s1">&#39;</span>,
      <span class="s1">&#39;</span><span class="s">out_trade_no</span><span class="s1">&#39;</span>: <span class="nv">str</span><span class="ss">(</span><span class="k">random</span>.<span class="nv">randint</span><span class="ss">(</span><span class="mi">10000000000</span>,<span class="mi">99999999999</span><span class="ss">))</span>,
      <span class="s1">&#39;</span><span class="s">total_amount</span><span class="s1">&#39;</span>: <span class="nv">str</span><span class="ss">(</span><span class="mi">9999999</span>.<span class="mi">99</span><span class="ss">)</span>
  }

  <span class="nv">order_str</span> <span class="o">=</span> <span class="nv">ali</span>.<span class="nv">api_alipay_trade_page_pay</span><span class="ss">(</span><span class="o">**</span><span class="nv">data</span><span class="ss">)</span>

  <span class="nv">request_url</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">https://openapi.alipaydev.com/gateway.do?</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nv">order_str</span>

  <span class="nv">print</span><span class="ss">(</span><span class="nv">request_url</span><span class="ss">)</span>
</pre></div>


<p>Index()
  ```</p>
        </div><!-- /.entry-content -->

</article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="/" rel="alternate">atom feed</a></li>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>, which takes great advantages of <a href="http://python.org">python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://smashingmagazine.com">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>